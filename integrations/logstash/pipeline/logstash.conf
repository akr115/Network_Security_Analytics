input {
    beats {
        port => 6000
    }
}

filter {
    # Extract only the `decoded.csv` array from the incoming event
    mutate {
        rename => { "[decoded][csv]" => "[csv]" }
        remove_field => [
            "@version",
            "@timestamp",
            "agent",
            "ecs",
            "event",
            "host",
            "input",
            "log",
            "message",
            "tags",
            "decoded"
        ]
    }
}
output {
    # Send full JSON body to your FastAPI /test-logstash endpoint
    http {
        url => "http://predictor_api:8000/test-logstash"
        http_method => "post"
        format => "json"
        content_type => "application/json"
    }
    stdout {
        codec => rubydebug
    }
}